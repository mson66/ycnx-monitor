<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç²¤è½¦å—ä¸‹é¦™æ¸¯å¸‚åŒºä¸­ç­¾æ•°æ®</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --primary: #007aff; --bg: #f5f5f7; --card: #ffffff; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: var(--bg); margin: 0; padding: 20px; color: #1d1d1f; }
        .container { max-width: 800px; margin: 0 auto; }
        
        /* å›¾è¡¨å®¹å™¨ */
        .chart-container { background: var(--card); border-radius: 16px; padding: 20px; margin-bottom: 25px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); }
        
        /* åˆ—è¡¨å¡ç‰‡æ ·å¼ */
        .card { background: var(--card); border-radius: 16px; padding: 20px; margin-bottom: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); transition: transform 0.2s; }
        .card:hover { transform: translateY(-2px); }
        
        .card-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee; padding-bottom: 12px; margin-bottom: 12px; }
        .period-id { font-weight: 600; color: #86868b; }
        .draw-date { font-size: 0.9em; color: #86868b; }
        
        .rate-row { margin: 15px 0; }
        .rate-label { font-size: 1.1em; color: #1d1d1f; font-weight: 500; }
        .rate-value { font-size: 1.8em; font-weight: 700; color: var(--primary); margin-left: 5px; }
        
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; background: #f9f9fb; padding: 12px; border-radius: 10px; }
        .stat-item { font-size: 0.9em; color: #424245; }
        .stat-item b { color: #1d1d1f; }
        
        .footer { text-align: center; font-size: 0.8em; color: #86868b; margin-top: 50px; padding: 20px 0; border-top: 1px solid #ddd; }
    </style>
</head>
<body>
    <div class="container">
        <h1 style="text-align: center; margin-bottom: 30px;">ç²¤è½¦å—ä¸‹ä¸­ç­¾ç›‘æ§</h1>

        <div class="chart-container">
            <canvas id="trendChart"></canvas>
        </div>

        <div id="history-list">
            <p style="text-align: center; color: #999;">æ­£åœ¨åŠ è½½æœ€æ–°æ•°æ®...</p>
        </div>

        <div class="footer">
            Created by MSON, Data from Official Website.
        </div>
    </div>

    <script>
        async function initDashboard() {
            try {
                const response = await fetch(`./history_data.json?v=${Date.now()}`);
                const data = await response.json();
                
                // æ¸²æŸ“å›¾è¡¨
                renderChart(data);
                
                // æ¸²æŸ“åˆ—è¡¨
                renderList(data);
                
            } catch (error) {
                console.error("åŠ è½½å¤±è´¥:", error);
                document.getElementById('history-list').innerHTML = "æ•°æ®åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•ã€‚";
            }
        }

        function renderChart(data) {
            const ctx = document.getElementById('trendChart').getContext('2d');
            // åè½¬æ•°ç»„ä»¥æŒ‰æ—¶é—´é¡ºåºæ˜¾ç¤ºè¶‹åŠ¿ï¼ˆä»æ—§åˆ°æ–°ï¼‰
            const chartData = [...data].reverse();
            
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: chartData.map(item => `ç¬¬${item.period_id}æœŸ`),
                    datasets: [{
                        label: 'ä¸­ç­¾ç‡ (%)',
                        data: chartData.map(item => parseFloat(item.winning_rate)),
                        borderColor: '#007aff',
                        backgroundColor: 'rgba(0, 122, 255, 0.1)',
                        fill: true,
                        tension: 0.4,
                        borderWidth: 3,
                        pointRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { beginAtZero: true, ticks: { callback: value => value + '%' } }
                    }
                }
            });
        }

        function renderList(data) {
            const listDiv = document.getElementById('history-list');
            listDiv.innerHTML = data.map(item => {
                const total = parseInt(item.total_applicants);
                const win = parseInt(item.winners_count);
                const lose = total - win;

                return `
                    <div class="card">
                        <div class="card-header">
                            <span class="period-id">ç¬¬ ${item.period_id} æœŸ</span>
                            <span class="draw-date">æŠ½ç­¾æ—¥æœŸ: ${item.draw_date}</span>
                        </div>
                        <div class="rate-row">
                            <span class="rate-label">ä¸­ç­¾ç‡ï¼š</span>
                            <span class="rate-value">${item.winning_rate}</span>
                        </div>
                        <div class="stats-grid">
                            <div class="stat-item">âœ… ä¸­ç­¾äººæ•°ï¼š<b>${win.toLocaleString()}</b></div>
                            <div class="stat-item">âŒ æœªä¸­ç­¾ï¼š<b>${lose.toLocaleString()}</b></div>
                            <div class="stat-item" style="grid-column: span 2; margin-top: 5px; color: #86868b; font-size: 0.85em;">
                                ğŸ“Š æ€»ç”³è¯·äººæ•°ï¼š${total.toLocaleString()}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        initDashboard();
    </script>
</body>
</html>